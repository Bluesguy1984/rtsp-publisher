version: "3.8"

services:
  rtsp-publisher:
    build: .
    container_name: rtsp-publisher
    ports:
      - "9188:9188"
    privileged: true
    network_mode: host
    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9188/health"]
      interval: 30s
      timeout: 5s
      retries: 3

    environment:
      CAMERA_NAME: camera
      CAMERA_INDEX: "0"
      RTSP_PORT: "8554"
      RTSP_PATH: camera
      WIDTH: "1280"
      HEIGHT: "720"
      FPS: "20"
      BITRATE: "4000000"

    volumes:
      - /dev:/dev
      - /run/udev:/run/udev:ro
      - /usr/lib:/usr/lib:ro
      - /usr/libexec:/usr/libexec:ro
      - /usr/share/libcamera:/usr/share/libcamera:ro
